배칭: 많은 수의 데이터 조각을 하나의 거대한 데이터 덩어리로 만드는 것

배칭의 목적: 계산 시간 단축

## 1. 드로우 콜
---
드로우 콜: CPU가 GPU에게 어떤 사물을 그려달라고 요청하는 것

드로우 콜을 위해서는 씬 초기화 때 메시, 텍스처 데이터를 RAM에서 VRAM으로 전송시킨다. 그 후 CPU는 객체를 그리는 데 필요한 렌더링과 옵션을 준비시킨다.

하나의 객체를 렌더링하기 전에 필요한 다양하고 복잡한 설정을 렌더 상태라고 하는데, 이를 바꾸는 데에는 많은 시간이 걸린다.

렌더 상태 결정 후에는 어떤 머티리얼을 어떻게 배치시킬지 결정한 후 명령어 형태로 GPU로 전달하여 순차적으로 수행하게 한다. 여기에서 두 하드웨어 간의 속도 차이가 난다면 병목현상이 일어나게 된다.

렌더 상태는 만약 객체들의 렌더 상태가 완벽하게 일치한다면 바뀌지 않는다.

## 2. 재질과 셰이더
---
셰이더: GPU가 정점과 픽셀 데이터를 어떻게 렌더링할지 정의한 프로그램

하나의 메시에 다양한 셰이더를 적용하면 적용된 셰이더 수만큼 다양한 재질이 필요하다. 재질의 수가 적으면 렌더 상태의 변화는 최소화되고 CPU 사용량도 줄게 된다.

## 3. 동적 배칭(Dynamic Batching)
---

목적: 여러 개의 단순한 메시들을 하나의 메시인 것처럼 묶어 한번에 렌더링하기 위해

개념: 씬 위의 객체들 중 같은 재질로 만들어진 것을 확인하고 배칭을 합쳐 한 번에 처리하는 방식

제한사항
* 모든 메시는 같은 재질로 이뤄져 있어야 한다.
* 파티클 시스템과 메시만이 동적 배치의 대상이 될 수 있다. 카툰 렌더링에 쓰이는 표면 처리된 메시나 렌더링 가능한 이외의 객체는 배치로 묶을 수 없다.
* 셰이더에 전성되는 정점 속성의 최대 개수는 900개이다.
* 모든 메시가 균등 스케일 또는 비균등 스케일로 이뤄져 있어야 한다.
* 모든 메시 인스턴스들은 같은 라이트맵을 사용해야 한다.
* 단일 패스를 사용하는 재질, 즉 단일 셰이더를 사용해야 한다.
* 메시는 실시간 그림자를 받지 않아야 한다.
* 전체 배치에는 총 32,000개의 메시 인덱스만 존재할 수 있다.

장점: 공통 요소로 이루어진 다수의 메시를 한 번에 그릴 수 있음

쓰면 안 되는 상황: 작은 수의 메시를 포함하는 다수의 배치로 이뤄진 장면 등의 이용이 제한되어 있는 장면

## 4. 정적 배칭(Static Batching)
---
목적: 다른 조건의 메시들을 묶어 한번에 렌더링하기 위해

개념: 프로그램 초기화 시점에 배치를 만드는 방식, 하나의 버퍼에 모든 메시와 변환 매트릭스를 저장한다.

제한사항
* 정적 메시로 선언해야 한다.
* 정적 배치를 할 때마다 메모리 자원이 추가로 소모된다.
* 소스에 상관없이 메시의 인스턴스를 묶을 수 있지만 같은 재질로 만들어진 객체만 묶을 수 있다.

장점: 다른 재질의 메시도 한 번에 그릴 수 있음

단점
* 에디터 모드에서 정적 배치 디버깅이 어렵다.
* 실행 중에는 정적 메시가 생성되도 정적 배칭이 일어나지 않는다.
* 시야에 보인 객체가 하나라도 포함되면 모두 렌더링한다.
* 정적 배치가 적용된 객체는 고정된 위치에서 벗어날 수 없다.

쓰면 안 되는 상황: 동적 배칭을 사용했을 때 효율적인 장면